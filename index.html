<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <META NAME="ROBOTS" CONTENT="NONE, NOINDEX">
    <link rel="icon" href="favicon.ico">

	<title>Connected Life. Emergencias.</title>
	
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/jumbotron.css" rel="stylesheet">
    
    <!-- app -->
	<link rel="stylesheet" href="css/style.css">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->


   	<!-- Modal requiere jQuery -->
    <script src="js/jquery/jquery.min.js"></script>
   	<!-- Modal requiere bootstrap.min.js-->	
    <script src="js/bootstrap/bootstrap.min.js"></script> 
        
    <script src="js/bootstrap/ie-emulation-modes-warning.js"></script>

	<!-- Este plugin necesita jQuery -->
    <script src="js/bootstrap/collapse.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    

 <script>
 	//Impedir reentrada, p.e. tras el login modal de médico. No ortodoxo.
//    if (window.location.search.substr(1)=='') {window.history.back()};
 	var originalURL = window.location.search.substr(1); //la original con su pathinfo. antes del redirect del cms/referrer
 	var cmsURL="http://ideas:7070"+originalURL; // la del mWS CMS que convierte el pathinfo a querystring //ToDo: cambiar en PRO

   	
   	var DESARROLLO = false;
   	var Loaded = false;
    var env;
    var customerId; 
    var projectId;
    var packId;
    var id;
    var eMail="NO";
    var password="NO";
	var personaId="0";


	function devAlert(str){
			if (DESARROLLO==true) {
				alert( str );
				};
	};

	function validateDNI(dni)
	{
    	// Comprobamos si tiene longitud 9
    	if(dni.length == 9) {
        		// Extraemos los 8 primeros caracteres
        		numbers_DNI = dni.substring(0,8);
 
        		// Función que comprueba si un número es un
        		// entero no negativo
        		var isInteger = function(n){
           			 var intRegex = /^\d+$/;
            		if(intRegex.test(n)) return true;
            		return false;
        }
 
        // Comprobamos si los 8 primeros caracteres
        // son números
        if(!isInteger(numbers_DNI)) return false;
 
        // Extraemos el último caracter
        letter_DNI = dni.substring(8);
 
        // Función que hemos elaborado antes para
        // el cálculo de la letra
        var get_letter_DNI = function(dni)
        {
            var table = "TRWAGMYFPDXBNJZSQVHLCKE";
            return table.charAt(dni % 23);
        }
 
        // Calculamos la letra de las cifras que se
        // han introducido
        letter_calculated = get_letter_DNI(numbers_DNI);
 
        // Si la letra es correcta damos por válido el DNI
        if(letter_calculated == letter_DNI) return true;
    }
 
    return false;
}

  
	function APImedCall(dniMed,colegiado){
		//$("#alert-warning").attr("data-toggle","collapsed");
		$("divwarning").hide();
//		$("#alert-error").attr("data-toggle","collapse");
//		$("#alert-danger").attr("data-toggle","collapse");
//		$("#alert-success").attr("data-toggle","collapse");

		if (validateDNI(dniMed)==false){
			 		    $("#diverror").hide();
			 			$("#divsuccess").hide();
			 			$("#divwarning").hide();
			 			$("#divdanger").show();
			 			devAlert('KO');
			 			return false;									
		}
		else {

		$.ajax({
			url: "http://ideas:7070/APImed?",
			data: {
				"customerId": customerId,
				"projectId": projectId,
				"packId": packId,
				"id": id,
				"InputColegiado": colegiado
			},
			type: "GET",
				success: function(data){
					// Se ejecuta cuando se ha recibido correctamente
					// los datos de la url
					console.log(data);
					if(data=="CGCOMAPIok") {
			 		     $("#diverror").hide();
			 			 $("#divsuccess").show();
			 			 $("#divwarning").hide();
			 			 $("#divdanger").hide();
						 $("#candado").attr("src","/img/candado-blanco-abierto.png");
						 $("#HistorialMedico").attr("data-toggle","collapse");
						 $("#historial").collapse({ toggle: true });
						 devAlert('ok');
						 $("#medLogin").modal("hide");
						 return true;
					}
					else{
			 		    $("#diverror").hide();
			 			$("#divsuccess").hide();
			 			$("#divwarning").hide();
			 			$("#divdanger").show();
			 			devAlert('KO');
			 			return false;						
					}
				},

				error: function(){
				// Se ejecuta cuando es imposible obtener
				// los datos de la url
				    console.log('No se puede acceder al servidor');
			 		devAlert('ERROR');
			 		$("#diverror").show();
			 		$("#divsuccess").hide();
			 		$("#divwarning").hide();
			 		$("#divdanger").hide();

				    return false;
				},

			async: false, // La petición es síncrona
			cache: false // No queremos usar la caché del navegador
			});		
		};

		return false;
	}




				function setFicha(){
					//Cargar los datos en la ficha //ToDo: Mostrar fichas de las otras personas, aquí sólo está el Usuario Principal

					//Del login en la barra (aunque no tienen por qué conservarse al recargar esta página)
					document.getElementById('eMail').innerHTML=env.USER_DATA.REGISTRO[0].EMAIL;
					document.getElementById('password').innerHTML=env.USER_DATA.REGISTRO[0].PASSWORD;		
					
					//IDENTIFICATIVOS
					if (env.USER_DATA.REGISTRO[0].FICHAS[personaId].FOTO != "NO")
						{document.getElementById("salFoto").src=env.USER_DATA.REGISTRO[0].FICHAS[personaId].FOTO}
					else	
						{document.getElementById("salFoto").src="img/salvame/foto.jpg"};
												
					document.getElementById("salNombre").innerHTML=env.USER_DATA.REGISTRO[0].FICHAS[personaId].NOMBRE;
					document.getElementById("salDNI").innerHTML=env.USER_DATA.REGISTRO[0].FICHAS[personaId].DNI;
					document.getElementById("salDireccion").innerHTML=env.USER_DATA.REGISTRO[0].FICHAS[personaId].DIRECCION;

					//CONTACTOS
					document.getElementById("AAA1name").innerHTML=env.USER_DATA.REGISTRO[0].CONTACTOS[0].CONTACTO;
					var ph1=env.USER_DATA.REGISTRO[0].CONTACTOS[0].TFCONTACTO;
					document.getElementById("AAA1phone").innerHTML='<a href="tel:'+ph1+'" class="fBlue linkHover">'+ph1+'</a>';
					document.getElementById("AAA1Mail").innerHTML=env.USER_DATA.REGISTRO[0].CONTACTOS[0].EMAILCONTACTO;

					document.getElementById("AAA2name").innerHTML=env.USER_DATA.REGISTRO[0].CONTACTOS[1].CONTACTO;	
					var ph2=env.USER_DATA.REGISTRO[0].CONTACTOS[1].TFCONTACTO;
					document.getElementById("AAA2phone").innerHTML='<a href="tel:'+ph2+'" class="fBlue linkHover">'+ph2+'</a>';	
					document.getElementById("AAA2Mail").innerHTML=env.USER_DATA.REGISTRO[0].CONTACTOS[1].EMAILCONTACTO;

					document.getElementById("AAA3name").innerHTML=env.USER_DATA.REGISTRO[0].CONTACTOS[2].CONTACTO;	
					var ph3=env.USER_DATA.REGISTRO[0].CONTACTOS[2].TFCONTACTO;
					document.getElementById("AAA3phone").innerHTML='<a href="tel:'+ph3+'" class="fBlue linkHover">'+ph3+'</a>';	
					document.getElementById("AAA3Mail").innerHTML=env.USER_DATA.REGISTRO[0].CONTACTOS[2].EMAILCONTACTO;
					
					var verContactos=(env.USER_DATA.REGISTRO[0].VERCONTACTOS != "NO");
					if (verContactos==true) {
						//Mostrar contactos. Abrir candado
						 $("#candadoContactos").attr("src","/img/candado-blanco-abierto.png");
						 $("#contactosParent").attr("data-toggle","collapse");
						 $("#contactos").collapse({ toggle: true });
					} 
					else {
						 //Ocultar contactos. Cerrar candado
						 $("#candadoContactos").attr("src","/img/candado-blanco.png");
						 $("#contactos").collapse({ toggle: false });	
						 $("#contactosParent").attr("data-toggle","collapsed");		 
					}

					//HISTORIAL MEDICO
					if(env.USER_DATA.REGISTRO[0].FICHAS[personaId].RH !="NO"){
						document.getElementById("InputRH").value=env.USER_DATA.REGISTRO[0].FICHAS[personaId].RH}
					else{
						InputRH.value='';
					};
					if(env.USER_DATA.REGISTRO[0].FICHAS[personaId].ALERGIAS !="NO"){
     					document.getElementById("InputAlergias").value=env.USER_DATA.REGISTRO[0].FICHAS[personaId].ALERGIAS}
					else{
						InputAlergias.value='';
					};					
					if(env.USER_DATA.REGISTRO[0].FICHAS[personaId].ENFERMGRAVES !="NO"){
     					document.getElementById("InputEnfGraves").value=env.USER_DATA.REGISTRO[0].FICHAS[personaId].ENFERMGRAVES}
					else{
						InputEnfGraves.value='';
					};					
					if(env.USER_DATA.REGISTRO[0].FICHAS[personaId].OPERACIONES !="NO"){
     					document.getElementById("InputOpGraves").value=env.USER_DATA.REGISTRO[0].FICHAS[personaId].OPERACIONES}
					else{
						InputOpGraves.value='';
					};					
     				document.getElementById("InputDonanteOrganos").checked=(env.USER_DATA.REGISTRO[0].FICHAS[personaId].DONASANGRE!="NO");
     				document.getElementById("InputDonanteSangre").checked=(env.USER_DATA.REGISTRO[0].FICHAS[personaId].DONAORGANOS!="NO");
					if(env.USER_DATA.REGISTRO[0].FICHAS[personaId].TRATACTUAL !="NO"){
     					document.getElementById("InputTratamiento").value=env.USER_DATA.REGISTRO[0].FICHAS[personaId].TRATACTUAL}
					else{
						InputTratamiento.value='';
					};					
					if(env.USER_DATA.REGISTRO[0].FICHAS[personaId].ANALITICA !="NO"){
     					document.getElementById("InputAnalitica").value=env.USER_DATA.REGISTRO[0].FICHAS[personaId].ANALITICA}
					else{
						InputAnalitica.value='';
					};					
     				document.getElementById("InputTestamentoVital").checked=(env.USER_DATA.REGISTRO[0].FICHAS[personaId].TESTVITAL!="NO");
					if(env.USER_DATA.REGISTRO[0].FICHAS[personaId].OTRAS !="NO"){
     					document.getElementById("InputOtrosDatosMedicos").value=env.USER_DATA.REGISTRO[0].FICHAS[personaId].OTRAS}
					else{
						InputOtrosDatosMedicos.value='';
					};					

					var verHistorial=(env.USER_DATA.REGISTRO[0].FICHAS[personaId].MOSTRAR !="NO");
					if (verHistorial==true) {
						//Abrir candado. Permitir desplegar.
						 $("#candado").attr("src","/img/candado-blanco-abierto.png");
						 $("#HistorialMedico").attr("data-toggle","collapse");
						 $("#historial").collapse({ toggle: false });
					} 
					else {
						 //Ocultar historial. Cerrar candado
						 $("#candado").attr("src","/img/candado-blanco.png");
						 $("#historial").collapse({ toggle: false });	
						 $("#HistorialMedico").attr("data-toggle","collapsed");		 
					}

				};










	function pathinfo2querystring()
			{	
				
				if (Loaded==true){return};
				Loaded=true;

				function redireccionar(pagina) {
						location.href=pagina;
					} 



				/*function setFicha(){posición original. MOVIDA FUERA de esta función}^*/

				
				function enRuta() {
					//Examen de casos para los PageProducers
					//
					var id=env.ID;
					var key=env.key;  //ToDo: Esto no se debe enviar a la página
					var activation=env.ACTIVATION;
					//devAlert("activation="+activation);
					switch (activation) {
						case '0':							
									devAlert('La licencia no ha sido activada aún');
									redireccionar('./activacion.html');
								 	break;

						default: 
									//devAlert('Verificar validez de la licencia'); /// ToDo: Se supone que es correcta?
									var eMail=env.USER_DATA.REGISTRO[0].EMAIL;
									devAlert(eMail);
									if (eMail=='NO') {
										devAlert('No existe Usuario Principal: Redirigir a bienvenidaYRegistro')
										redireccionar('./bienvenidaYRegistro');
										break;
									}
									else {
										    //Gestionar la primera entrada hasta que haya datos
											if (env.USER_DATA.REGISTRO[0].FICHAS[0].NOMBRE=='NO') {
												document.getElementById("first").hidden=false;
												document.getElementById("Identidad").class="collapse Identidad";   //colapsado
											}
											else {
												//Ya hay datos, preparar la vista
												document.getElementById("first").hidden=true;
												document.getElementById("Identidad").class="collapse in Identidad"; //expandido
												//Cargar los datos en la ficha
												setFicha();
												break;
											}
										}
						}	

					};

				

				
				var cmsRead=function(cmsURL){
					$.get(cmsURL, function(htmlexterno)
						{

							$("#aux").html(htmlexterno);
							registro=JSON.parse(htmlexterno);
							//devAlert(registro.ID); //ok           

							sessionStorage.setItem("Registro", JSON.stringify(registro));
							env =  JSON.parse(sessionStorage.getItem("Registro"));						
							customerId  =  env.customerId; 
    						projectId   =  env.projectId;
    						packId      =  env.packId;
     						id          =  env.Id;
     						eMail		=  env.USER_DATA.REGISTRO[0].EMAIL;


							enRuta();



							         
						});
						
					};
				
				//Evitar redirecciones de página indeseables por los eventos submit
			 	document.getElementById("navForm").addEventListener("submit", function(event){
   								 event.preventDefault()
   				 });		
			 	document.getElementById("formIdMedico").addEventListener("submit", function(event){
   								 event.preventDefault()
   				 });
				//alert('before cmsRead');
				cmsRead(cmsURL);
				//alert('after cmsRead');
			


		}


	function login(email,password)
	//Desde la barra de menú
			{
				$.ajax({
					url: "http://ideas.es:7070/usrLogin",  //ToDo: cambiar en PRO
					data: {
						"customerId": customerId,
						"projectId": projectId,
						"packId": packId,
						"id": id,
						"eMail": document.getElementById('eMail').value,      //eMail,
						"password": document.getElementById('password').value,// password
						},
					type: "GET",
						success: function(data){
						if(data=="usrLoginOK") {
							//document.getElementById("loginUsr").innerHTML=eMail;
							// document.getElementById('eMail').value=eMail;     //No conveniente
							//document.getElementById('password').value=password;			 
    					 	//guardar los datos en la sesión
    					 	env.USER_DATA.REGISTRO[0].PASSWORD=password; 
						 	env.USER_DATA.REGISTRO[0].EMAIL=eMail;
						 	sessionStorage.setItem("Registro", JSON.stringify(env)); 					
							
							//Ir a Tu Zona
							location.href="./tuZona.html";

						 	return true;
						}
						else{
							//document.getElementById("loginUsr").innerHTML='Identidad no confirmada';			 				    	
			 				return false;						
						}
					},

					error: function(){
					// Se ejecuta cuando es imposible obtener
					// los datos de la url
   						//document.getElementById("loginUsr").innerHTML='Identidad no confirmada';			 
				    	alert('No se puede acceder al servidor');
				    	return false;
					},

					async: false, // La petición es síncrona
					cache: false // No queremos usar la caché del navegador
				});

				return false;
			};


		function cambiarPersona(){
		//Navegar de forma circular a la siguiente persona cuyo nombre sea !="NO" ni a ""
				if(document.getElementById('historial').clientHeight>0){
					//Cerrar el historial si está abierto
					$("#HistorialMedico").click();
				}	
				$("#historial").collapse({ toggle: false });	
			    personaId++;
			    if (personaId > 4){personaId = 0}
			    while (env.USER_DATA.REGISTRO[0].FICHAS[personaId].NOMBRE =='' || env.USER_DATA.REGISTRO[0].FICHAS[personaId].NOMBRE=='NO'){
					   personaId++;
					   if (personaId > 4){
					   		personaId = 0; 
					   		break;
					   	}

			   		}
			   		
			   setFicha();				   

		}

	</script>

</head>

<body onLoad="pathinfo2querystring();"> 

<input type="hidden" id="aux"/>

<nav class="navbar  navbar-inverse navbar-fixed-top">
 
  <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Cambiar navegación</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
           <a class="navbar-brand navbar-left" href="#">Mis datos</a>
           <a class="icon glyphicon glyphicon-share-alt navbar-brand navbar-left" onclick="cambiarPersona();"></a>
           <label class="navbar-brand navbar-left" id="persona">Usuario Principal</label>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <form id="navForm" class="navbar-form navbar-right" onSubmit="login(this.eMail.value,this.password.value);">
            <!--div class="form-group"--><img src="img/candado-blanco.png" align="left"/><!--/div-->
            <div class="form-group"  width="70px"> 
              <input id="eMail" type="text" placeholder="eMail" class="form-control">
            </div>
            <div class="form-group" width="70px">
              <input id="password" type="password" placeholder="Contraseña" class="form-control">
            </div>
            <button type="submit" class="btn btn-success">Tu Zona</button>
          </form>
        </div><!--/.navbar-collapse -->
  </div>
</nav>


   <!-- Main jumbotron for a primary marketing message or call to action -->
    <!--div class="jumbotron"-->
      <div class="container">
        <p/><p/>
        <div class="row">
      	  <div>
			<img src="img/logo400px.png" border="0" class="displayed">
		  </div>
		</div>
      </div>
    <!--/div-->
	
	
	
	
	
	
<div class="Pagina">
 	
	<div id="Ficha">
		<div id="first" name="first" class="container" hidden=true>
 			 <div class="alert alert-success">
    			<a href="tuZona.html" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    			<strong>¡Saludos!</strong>
    			<p style="color:#4ba246"> En <strong>Tu Zona</strong> puedes gestionar los datos que se ven en esta página introduciendo tu eMail y contraseña.</p>
 			 </div>
		</div>
	


		
		<div class="container">
 			<div class="rigthJustify fWhite negrita" data-toggle="collapse" data-target="#Identidad"> DATOS PERSONALES</div>
				<div id="Identidad" class="collapse in Identidad">
					<div class="izquierda retrato">
						<div class="mask circle">
							<img id="salFoto" src="img/salvame/foto.jpg" width="100%">
						</div>
					</div>

					<div class="derecha fGreen negrita">
						<p>
							<strong>Nombre:</strong><br>
							<span id="salNombre" class="fGrey">XXXXX XXXXXXXX XXXXXXXXXX</span>
						</p>
						<p>
							<strong>DNI:</strong><br>
							<span id="salDNI" class="fGrey">XXXXXXXXX-X</span>
						</p>
						<p>
							<strong>Dirección:</strong><br>
							<span id="salDireccion" class="fGrey">XX XXXXXXXXXXXXX XXXXX XXX XXXX XXXXXXXXXXXXX</span>
						</p>
				</div>
			 </div>
		</div>

		<div class="container">
 			<div class="rigthJustify fWhite negrita"> GEOLOCALIZACIÓN</div>

			<div id="map"></div>

			<div id="geolocation" class="rigthJustify fWhite negrita">Posición actual</div>		
			<div id="geolocalizacion" class="geolocalizacion negrita row" width="100%">
				 		<p/>				
				 		<div class="izquierda">
					  	<b style="color:#4ba246">GPS:</b><br/>
						<span class="fGrey" id="txtLat">...</span>,&nbsp;
						<span class="fGrey" id="txtLng">...</span>
						</div>
						<div class="derecha"
							<b style="color:#4ba246">Alrededores:</b><br/><span class="fGrey" id="txtAddress">...</span><br/>
						</div>
			</div>

		</div>
		<!--/div-->
			
		
		<div class="container">
 			<div id="contactosParent"class="rigthJustify fWhite negrita" data-toggle="collapse" data-target="#contactos">
 				<img id="candadoContactos" src="img/candado-blanco.png"/>CONTACTOS
 			</div>
			<div id="contactos" class="collapse">
				<div class="negrita">          
 				 	<table class="table">
    					<tbody>
      						<tr>
								<td><strong class="fGreen">AA1:</strong</td><td id="AAA1name"><span class="fGrey">XXXXXXXXXXX</span></td><td id="AAA1phone"><a href="tel:696555555" class="fBlue linkHover">6xxxxxxxx</a></td>
								<tr><td/><td id="AAA1Mail" class="address">@</td></tr> 
      						</tr>
      						<tr>
								<td><strong class="fGreen">AA2:</strong></td><td id="AAA2name"><span class="fGrey">XXXXXX</span></td><td id="AAA2phone"><a href="tel:696555555" class="fBlue linkHover">6xxxxxxxx</a></td>
								<tr><td/><td id="AAA2Mail" class="address">@</td></tr>
      						</tr>
      						<tr>
								<td><strong class="fGreen">AA3:</strong></td><td id="AAA3name"><span class="fGrey">XXXX XXXX</span></td><td id="AAA3phone"><a href="tel:696555555" class="fBlue linkHover">6xxxxxxxx</a></td>
								<tr><td/><td id="AAA3Mail" class="address">@</td></tr>
      						</tr>
   					 	</tbody>
  					</table>
  				</div>

			</div>    
		</div>
	

	<!--                                                 Historial médico - START                          -->


		<div class="container">

 			<div id="HistorialMedico" class="rigthJustify fWhite negrita" data-toggle="collapsed" data-target="#historial">
 					<img id="candado" src="img/candado-blanco.png"/>HISTORIAL MÉDICO</div>

				<div id="historial" class="collapse">
					<div class="container-fluid fGreen">
           		            
						<div class="form-group">
							<label for="InputRH">Grupo sanguíneo</label>
							<div class="input-group">
								<input type="text" class="form-control" name="InputRH" id="InputRH"  disabled>
								<span class="input-group-addon"><span class="glyphicon glyphicon-tint"></span></span>
							</div>
						</div>
						<div class="form-group">
							<label for="InputAlergias">Alergias</label>
							<div class="input-group">
								<input type="text" class="form-control" id="InputAlergias" name="InputAlergias" disabled>
								<span class="input-group-addon"><span class="glyphicon glyphicon-grain"></span></span>
							</div> 
						</div>
						<div class="form-group">
							<label for="InputEnfGraves"> Enfermedades graves</label>
							<div class="input-group">
								<input type="text" class="form-control" id="InputEnfGraves" name="InputEnfGraves" disabled>
								<span class="input-group-addon"><span class="glyphicon glyphicon-list-alt"></span></span>
							</div>
						</div>
						<div class="form-group">
							<label for="InputOpGraves">Operaciones importantes</label>
							<div class="input-group">
								<input type="text" class="form-control" id="InputOpGraves" name="InputOpGraves" disabled>
								<span class="input-group-addon"><span class="glyphicon glyphicon-list-alt"></span></span>
							</div>                           
						</div>                	
						<div class="form-group">
							<label for="InputDonante">Donante:</label>
							<div class="input-group">
								<label class="checkbox-inline"><input type="checkbox" class="" id="InputDonanteOrganos" name="InputDonanteOrganos" value="Organos" disabled>Órganos</label>
								<label class="checkbox-inline"><input type="checkbox" class="" id="InputDonanteSangre" name="InputDonanteSangre" value="Sangre" disabled>Sangre</label>
								<span class="input-group-addon"><span class="glyphicon glyphicon-list-alt"></span></span>
							</div>
						</div>  
						<div class="form-group">
							<label for="InputTratamiento">Tratamiento médico actual</label>
							<div class="input-group">
								<textarea name="InputTratamiento" id="InputTratamiento" class="form-control" rows="5" disabled placeholder="Tratamiento médico actual: ( indicar la fecha de comienzo - fin) En caso de tratamiento por enfermedad crónica dejar fecha por defecto (31-12-9999)."></textarea>
								<span class="input-group-addon"><span class="glyphicon glyphicon-heart-empty"></span></span>
							</div>
						</div> 
						<div class="form-group">
							<label for="InputAnalitica">Última analítica</label>
							<div class="input-group">
								<textarea name="InputAnalitica" id="InputAnalitica" class="form-control" rows="5"  disabled placeholder="Resultado de ultima analítica, fecha: Marcar solo datos con valores fuera de los normales. Indicar valores coagulación (estos datos son válidos durante 6 meses)."></textarea>
								<span class="input-group-addon"><span class="glyphicon glyphicon-heart-empty"></span></span>
							</div>
						</div>                                             
						<div class="form-group">
							<div class="checkbox">
								<label><input name="InputTestamentoVital" id="InputTestamentoVital"type="checkbox" value="" disabled>Poseo <strong>Testamento Vital</strong></label>
							</div> 
							<label for="InputOtrosDatosMedicos">Otra información médica</label>
							<div class="input-group">
								<textarea name="InputOtrosDatosMedicos" id="InputOtrosDatosMedicos" class="form-control" rows="5" disabled></textarea>
								<span class="input-group-addon"><span class="glyphicon glyphicon-heart-empty"></span></span>
							</div>
						</div>                
						<div class="form-group">		
							<div>
								<div class="Documentos (informes, radiografías...)"><a href="#" style="color:#4ba246"><u>Documentos disponibles</u></a></div>                        
							</div>
                     
						</div>

					</div> <!-- div col lg6-->
				</div> <!--div id historial--> 
			</div> <!--div id HistorialMedico--> 
		</div> <!--div container-->
    <!-- Historial médico end-->

	</div><!-- fin ficha --> 
</div><!-- FIN página-->	
	

<!--                                         Login Modal Médico                                       -->

<div class="modal fade" id="medLogin" role="dialog">
    <div class="modal-dialog">
    
		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header" style="padding:35px 50px;">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4><span class="glyphicon glyphicon-lock"></span><b  class="fGreen">Identificación de Colegiado Médico</b> </h4>
				Si continúa con la acción: El Usuario Principal será notificado de los intentos de acceso a la OMC, para proteger su intimidad.
			</div>
			<div class="modal-body" style="padding:40px 50px;">
			<form   id="formIdMedico" action="#" role="form" onSubmit="APImedCall(this.dniMed.value,this.InputColegiado.value);">
				<div class="form-group">
					<label for="InputColegiado" class="fGreen"><span class="glyphicon glyphicon-user fGreen"></span> Número de Colegiado</label>
					<input type="password" class="form-control" id="InputColegiado" placeholder="A validar por la OMC" required>
				</div>
				<div class="form-group">
					<label for="dniMed" class="fGreen"><span class="glyphicon glyphicon-user fGreen"></span> DNI</label>
					<input type="text" class="form-control" id="dniMed" placeholder="DNI completo con letra" required>
				</div>
				<div class="col-lg-5 col-md-push-1">
						<button  action="#" type="submit" class="btn btn-success btn-block fWhite bGreen"><span class="glyphicon glyphicon-off"></span>Entrar</button>
						<br/>
						<br/>
					<div id="divwarning" class="col-md-14">
						<div id="alert-warning" class="alert  alert-warning">
							<strong class="fGreen"><span class="glyphicon glyphicon-ok"></span> Introduzca sus datos, por favor. </strong>
						</div>
					</div>
					<div id="divsuccess" class="col-md-14" hidden=true>
						<div id="alert-success" class="alert  alert-success">
							<strong class="fGreen"><span class="glyphicon glyphicon-ok"></span> Número de colegiado aceptado. </strong>
						</div>
					</div>
					<div id="divdanger"class="col-md-14" hidden=true>
						<div id="alert-danger-fail" class="alert  alert-danger">
							<span class="glyphicon glyphicon-remove"></span><strong id="msgWarning"> Por favor, rectifique.</strong>
						</div>
					</div>
					<div id="diverror" class="col-md-14" hidden=true>
						<div id="alert-danger-error" class="alert  alert-danger">
							<span class="glyphicon glyphicon-remove"></span><strong id="msgWarning"> No se pudo acceder a la OMC.</strong>
						</div>
					</div>		
				</div>				
			</form>
			</div>

		

			<div class="modal-footer">
				<button id="medSubmitButton" type="submit" class="btn  pull-left fWhite bGray" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Cancelar</button>
			</div>
			
		</div>
	</div>
</div>                

	
      <!-- Modal de Ayuda rápida-->
      <div id="ayudaRapida"  name="ayudaRapida" class="modal fade" role="dialog">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h3Connected Life Emergencias</h3>
                  <h4 class="modal-title">Ayuda rápida de <b style="color:#4ba246">Emergencias</b></h4>
                </div>
                <div class="modal-body">
                   <p><b>En caso de accidente o emergencia:</b></p>	
						<ul>
							<li>1.<b>No mueva al accidentado</b>.
							<li>2. Mire la <b class="fWhite bGreen">posición actual</b> en el mapa que se muestra y llame a emergencias pulsando el botón <B class="fWhite bRed">EMERGENCIAS 112</B>. Informe dónde se encuentra y qué sucede.
							<li>3. Pulse el botón <b class="fGreen">AVÍSALES</b>, para enviar un SMS de aviso (gratuito) a los familiares o personas de contacto que se muestran en la ficha.
							<li>4. Si es usted un especialista sanitario, acceda al historial médico e informes, pulsando sobre <B class="fGreen"> SOY MEDICO</B> e introduciendo su número de colegiado médico.
						</ul> 
				   <p/>						
				   <HR/>
                   <p>Connected Life <b>Emergencias</b> resumido:</p>
                   <ul>
                   		<li> <B class="fWhite bRed">EMERGENCIAS 112</b>: Al pulsar, <b>Emergencias</b> inicia una llamada al teléfono 112 desde este móvil.
                   		<li> <b class="fGreen">SOY MÉDICO</b>: Con su número de colegiado podrá desbloquear y consultar <b class="fWhite bGreen">HISTORIAL MÉDICO</b>.
                   		<li> <b class="fGreen">AVÍSALES</b>: Al pulsar, <b>Emergencias</b> avisa a los <b class="fWhite bGreen">CONTACTOS</b> que aparecen en la lista mediante un mensaje SMS gratuíto y un eMail con la <b class="fWhite bGreen">posición actual</b>.
                   </ul>
                  <p> Esperamos servirle de ayuda. Por favor, <u>utilice este servicio de manera responsable</u>.</p>
                   <b style="color:#4ba246">Connected Life.</b><br/> <br/>
                   
                   <i style="color:#4ba246">Conectados a la vida.</i>
                </div>
                <div class="modal-footer">
                 <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
     
               </div>
            </div>

         </div>
         
      </div>

<footer class="Pie">

<div class="panel panel-default">
  <div class="panel-body">
	 <div class="table-responsive negrita">          
 		<table class="table">
    		<tbody>
      			<tr>
					 <td class="bGreen"><strong><a  class="fWhite linkHover" href="avisales.html">AVÍSALES</a></strong</td>
					 <td class="bRed"><a class="fWhite linkHover" href="tel:112">EMERGENCIAS 112</a></td>
					 <td class="bGreen"><a class="fWhite linkHover" data-toggle="modal" data-target="#medLogin">SOY MÉDICO</a></td>
      			</tr>
      		</tbody>
      	</table>
      </div>

      <div align="center"> 
			<a href="#ayudaRapida" style="color:#4ba246" data-toggle="modal" data-target="#ayudaRapida" class="linkHover"><b><u>Ayuda rápida</u></b></a>
	  </div>   
  </div>
  <div class="panel-footer">
		<div align="center"> 
			<b>Emergencias</b>, &copy; 2016 Connected Life.
		</div>
  </div>
</div>

</footer>




	
    <script>

      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat:  40.4169, lng: -3.7033},   //La Puerta del Sol
          zoom: 18,
		  language: "es-es"
        });
        var infoWindow = new google.maps.InfoWindow({map: map});
        var marker = new google.maps.Marker({map: map});
		var address;
		
        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            
            var coords=JSON.stringify(pos);
            
            //Y la dirección a partir de las coordenadas
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({'latLng': pos}, function(results, status){
			if (status == google.maps.GeocoderStatus.OK){
				if (results[0]) {
					address=results[0].formatted_address
				} else address="Address unsolved / Dirección no resuelta";
			} else address="Coordenates conversion failed / Fallo de conversión de las coordenadas";

			//infoWindow.setContent(address+coords);
			//infoWindow.visible=false;//ility: hidden;
            marker.setPosition(pos);


			var latn = Math.abs(pos.lat);
			var latgr = Math.floor(latn * 1);
			var latmin = Math.floor((latn - latgr) * 60);
			var latseg = ((((latn - latgr) * 60) - latmin) * 60);
			var latc = (latgr + "º" + latmin + "\'" + latseg.toFixed(2) + '\"');
			var x = (latn>0)? latc+'N' : latc+'S';
		
			var lngn = Math.abs(pos.lng);
			var lnggr = Math.floor(lngn * 1);
			var lngmin = Math.floor((lngn - lnggr) * 60);
			var lngseg = ((((lngn - lnggr) * 60) - lngmin) * 60);
			var lngc = (lnggr + "º" + lngmin + "\'" + lngseg.toFixed(2) + '\"');
			var y =(lngn>0)? lngc+'E' : lngc+'W';
			
			document.getElementById('txtAddress').innerHTML=address;
		    document.getElementById('txtLat').innerHTML= x;
		    document.getElementById('txtLng').innerHTML= y;		
			});


            infoWindow.setPosition(pos);
            marker.setPosition(pos);
            infoWindow.setContent(address);
			infoWindow.close();//=false;
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The geolocation service failed / El servicio de geolocalización ha fallado.' :
                              'Error: Your browser doesn\'t support geolocation / El navegador no soporta geolocalización.');
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQluvHWDNjZls1G4_Vz-Rjnm0wx5GRCi0&callback=initMap&language=es">
    </script>



	 <!-- appCL -->


  </body>
  
</html>
